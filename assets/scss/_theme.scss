$black-color-border-highlight: lighten(black, 22%);
$black-color-border-input: lighten(black, 32%);
$black-body-bg: #0f0f13;
$black-bg: #1c1f24;
$black-bg-hover: lighten(#1c1f24, 5%);
$black-bg-highlight: #383f4a;
$black-bg-active: lighten($black-bg-highlight, 15%);
$black-color-border: lighten($black-bg, 5%);
$black-color-text: lighten(black, 90%);
$black-color-text-info: lighten(black, 65%);
$black-color-text-subtitle: lighten(black, 70%);
$black-color-text-comment: lighten(black, 55%);
$black-btn-bg: lighten(black, 25%);
$black-btn-bg-hover: lighten(black, 40%);
$black-color-main: #81fffa;

@mixin dark-mode(){
  .radio-list{
    .radio-list-item{
      &.active{
        color: $black-color-main;
      }
    }
  }



  // 暗黑模式下的滚动条样式
  ::-webkit-scrollbar-track {
    background-color: rgba(0, 0, 0, 0);
  }
  ::-webkit-scrollbar-thumb {
    border-color: lighten($black-color-border-highlight, 10%);
    background-color: $black-color-border-highlight !important;  }
  body {
    background-color: $black-bg !important;
  }
  .search-bar {
    background-color: $black-bg;
    border-bottom-color: $black-color-border;
  }
  
  // 修复sync-warning类的背景色（仅tool页面生效）
  .tool.theme-dark body .sync-warning,
  .tool.theme-dark .sync-warning {
    background-color: $black-body-bg !important;
    border-color: lighten($black-color-border-highlight, 10%) !important;
    color: $black-color-main !important;
  }
  
  // 修复schema-list类的背景色
  html.theme-dark body .schema-list,
  body.theme-dark .schema-list {
    background-color: $black-bg !important;
    border-right-color: $black-color-border !important;
  }
  
  // 修复content类的背景色
  html.theme-dark body .content, 
  html.theme-dark body .group-container,
  body.theme-dark .content,
  body.theme-dark .group-container {
    background-color: $black-bg !important;
  }
  
  // 修复sync-file-item类的背景色
  .tool.theme-dark body .sync-file-item,
  .tool.theme-dark .sync-file-item {
    background-color: $black-bg-highlight !important;
    color: $black-color-text !important;
    border-color: $black-color-border !important;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5) !important;

    .remove-x {
      color: $black-color-main !important;
    }
  }
  
  // 修复tool-container类的背景色
  html.theme-dark body .container.tool-container,
  body.theme-dark .container.tool-container {
    background-color: $black-body-bg !important;
  }
  
  // 修复rename-file-list区域的对比度
  .tool.theme-dark body .rename-file-list,
  .tool.theme-dark .rename-file-list {
    .rename-file-list-item {
      input {
        background-color: $black-bg-highlight !important;
        color: $black-color-text !important;
        border-color: $black-color-border-highlight !important;
        
        &:hover, &:focus {
          background-color: $black-bg-active !important;
          border-color: $black-color-main !important;
        }
      }
      
      .filepath {
        color: $black-color-text-subtitle !important;
      }
    }
  }
  
  .input-item {
    .btn-clear {
      background-color: $black-bg-highlight;
      &:hover{
        background-color: $color-main;
      }
    }
  }


  .word-redundancy-list{
    background-color: $black-bg;
    border: 1px solid $black-color-border;
    @include box-shadow(2px 2px 5px transparentize(black, 0.4));
    &-item{
      .word{
        color: $black-color-text;
      }
      .code{
        color: $black-color-text-subtitle;
      }
      .origin{        &.blue{
          color: $dark-blue;
        }
        color: $color-success;
      }
      &:hover{
        background-color: $black-bg-highlight;
        .word{
          color: white;
        }
        .code{
          color: white;
        }
        .origin{
          color: white;
        }
      }
    }
  }



  // index
  .main-tool{
    border-color: $black-color-border;
    .tool-panel{
      border-right-color: $black-color-border;
      background-color: $black-bg;
      .title{
        color: $black-color-text;
      }
      .content{
        background-color: $black-body-bg;
      }
      .tip{
        color: $black-color-main;
      }

      &::-webkit-scrollbar-thumb {
        border: none;
        background-color: $black-color-border-highlight;
      }
    }
  }

  .modal{
    background-color: rgba(255,255,255,0.2);
  }

  .modal-panel{
    border-color: $black-color-border-highlight;
    background-color: $black-bg;
    .modal-close{
      background-color: transparentize(white, 0.9);
      &:hover{
        background-color: transparentize(white, 0.7);
      }
    }
    .modal-header{
      border-color: $black-color-border;
      background-color: $black-bg;
      color: $black-color-text;
    }
    .modal-body{
      label{
        color: white;
      }
      input{
        border-color: $black-color-border-highlight ;
        width: 100%;
        &:focus{
          border-color: $black-color-main;
        }
      }
    }
    .modal-footer{
      border-color: $black-color-border;
      background-color: $black-bg;
      display: flex;
      justify-content: center;
    }
  }


  .group {
    color: $black-color-text;
    .group-header {
      color: $black-color-main;
      &:hover {
        background-color: $black-bg-hover;
      }
      &.active {
        background-color: $black-bg-highlight;
      }
    }
  }
  .word-item {
    .checkbox-cell{
      .checkbox-item{
        width: $height-checkbox;
        background-color: $black-bg;
        border: 1px solid $black-color-border-input;
        &.active{
          border-color: $black-color-main;
          &:after{
            background-color: $black-color-main;
          }
        }
      }
    }
    &:hover {
      background: $black-bg-hover;
      .checkbox-cell {
        label {
          border-color: $black-color-main;
        }
      }
    }
    &:after {
      background-color: $black-color-border;
    }
    .code {
      color: $black-color-text-subtitle;
    }
    .indicator{
      color: $black-color-main;
    }
    .operation {
      .up, .down{
        &:hover{
          background-color: $black-bg-highlight;
        }
        &:active{
          background-color: $black-bg-active;
        }
      }
    }
    &:hover{
      .checkbox-cell{
        .checkbox-item{
          border-color: $black-color-main !important;
        }
      }
      .operation{
        opacity: 1;
      }
    }
  }
  .catalog-list {
    color: $black-color-text;
    border-right-color: $black-color-border !important;
    .catalog-item {
      .up, .down{
        &:hover{
          border-color: black;
          background-color: black;
        }
      }
      &:hover {
        background-color: $black-bg-hover !important;
      }
      &.active {
        color: black !important;
        background-color: $black-color-main !important;
      }
    }
  }
  .schema-list {
    color: $black-color-text;
    border-right-color: $black-color-border !important;
    .schema-list-item {
      &:hover {
        background-color: $black-bg-hover !important;
      }
      &.active {
        color: black !important;
        background-color: $black-color-main !important;
      }
    }
  }
  .footer {
    background-color: $black-bg;
    border-top-color: $black-color-border-highlight;
    color: $black-color-text;
    .tip{
      text-shadow: 1px 1px 1px rgba(0,0,0,0.1), -1px -1px 0 black;
    }
    .link {
      &:hover {
        color: $black-color-main !important;
      }
    }
  }
  .shadow{
    @include box-shadow(1px 2px 5px rgba(0,0,0,0.5))
  }
  .file-list {
    color: $black-color-text;
    background-color: $black-bg-hover;
    box-shadow: 2px 2px 15px black;
    //border-color: #00448e;
    .file-list-item {
      border-bottom-color: $black-color-border;
      &:hover {
        background-color: $black-bg-highlight;
      }      &.active, &:active {
        background-color: $dark-blue;
        color: black;
      }
    }
  }
  .checkbox-cell{
    .checkbox-item{
      background-color: $black-bg-highlight;
      border-color: $black-bg-highlight;
    }
  }

  /*CONFIG*/
  .config {
    section {
      margin-bottom: 30px;
      .section-title {
        color: $black-color-text;
        .desc {
          color: $black-color-text-subtitle;
        }
      }
      .section-content {
        background-color: $black-body-bg;
        color: $black-color-text;
      }
    }
  }
  .config-file-list {
    .config-file-list-item {
      border-bottom-color: $black-color-border;
      .name {
        color: $black-color-text;
      }
      .path {
        color: $black-color-text-subtitle;
      }
      &.active {
        background-color: $black-color-main;
        border-bottom-color: $black-color-main;
        .name, .path {
          color: $text-main;
        }
        &:hover {
          background-color: $black-color-main;
          border-bottom-color: $black-color-main;
        }
      }
      &:hover {
        background-color: $black-bg-highlight;
      }
    }
  }
  .login-user-info {
    background-color: $black-bg;
    border-color: $black-color-border;
  }

    /*BUTTONS*/
  input[type=radio] + label.radio {
    background-color: $black-bg;
    border-color: $black-color-border-highlight;
  }
  input[type=radio]:checked + label.radio {
    border-color: $black-color-main;
  }
  label.radio:hover {
    border-color: $black-color-main !important;
  }
  input[type=radio]:checked + label.radio {
    &:after {
      background-color: $black-color-main;
    }
  }
  .audio-switch {
    input {
      display: none;
    }
    input + label {
      box-sizing: content-box;
      border: 2px solid $text-subtitle;
      background-color: $text-subtitle;
      &:before {
        border-color: transparent;
        background-color: $black-bg;
      }
    }
    input:checked + label {
      border-color: $green;
      background-color: $green;
    }
  }
  input, select {
    &::-webkit-input-placeholder{
      color: rgba(255,255,255,0.3);
    }
    color: $black-color-text;
    &:focus {
      border-color: $black-color-main;
      @include box-shadow(0 0 0 2px transparentize($black-color-main, 0.5))
    }
  }
  input[type=checkbox] + label.checkbox {
    background-color: $black-body-bg;
    border-color: $black-color-border;
  }
  input[type=checkbox]:checked + label.checkbox {
    border-color: $black-color-main;
  }
  label.checkbox:hover {
    border-color: $black-color-main !important;
  }
  input[type=checkbox]:checked + label.checkbox {
    &:after {
      background-color: $black-color-main;
    }
  }
  input {
    background-color: $black-body-bg;
    border-color: $black-color-border-input;
  }

  @each $name, $color in $btns {
    // BTN
    .btn-#{$name} {
      @if $name == primary {
        color: $black-color-text;
        text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        background: linear-gradient(to bottom, $black-btn-bg, darken($black-btn-bg, 5%));
        border: 1px solid $black-btn-bg;
      } @else {
        text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        color: white;
        background: linear-gradient(to bottom, darken($color, 5%), darken($color, 10%));
        border: 1px solid $color;
      }
      &:hover {
        @if $name == primary {
          color: $black-color-text;
          background-color: $black-btn-bg-hover;
          border: 1px solid $black-btn-bg-hover;
        } @else {
          background: linear-gradient(to bottom, $color, $color);
          border-color: $color;
        }
      }
      &:active {
        @if $name == primary {
        } @else {
          background-color: darken($color, 10%);
        }
      }
    }

    // BTN-ALT
    .btn-alt-#{$name} {
      border-color: transparent;
      background-color: transparent;
      color: $color;
      &:hover {
        border-color: $color;
        color: $color;
      }
      &:active {
        color: $color;
      }
    }
  }

  /*TOOL*/
  .tool-container, .tool{
    background-color: $black-bg;
    .tool-panel{
      border-right-color: $black-color-border;
      background-color: $black-bg !important;
      .title{
        color: $black-color-text;
        &.green {
          color: #4CD964 !important;
        }
        &.roseo {
          color: #FF2D70 !important;
        }
        &.blue {
          color: $black-color-main !important;
        }
      }
      .content{
        background-color: $black-body-bg;
      }
      .tip{
        color: $black-color-text !important;
      }

      &::-webkit-scrollbar-thumb {
        border: none;
        background-color: $black-color-border-highlight;
      }
    }
    hr{
      border-color: $black-color-border;
    }


    .readme{
      .readme-item{
        h3{
          color: $black-color-text;
        }
        p{
          color: $black-color-text-subtitle;
          i{
            color: $black-color-main;
          }
        }
      }
    }
  }
}

/* 只影响 tool.html 的暗黑模式 */
.tool.theme-dark .tool-panel {
  background-color: #1c1f24 !important;
}
.tool.theme-dark .tool-panel .content {
  background-color: #0f0f13 !important;
}
.tool.theme-dark .tool-panel section .title {
  color: #e6e6e6 !important;
}
.tool.theme-dark .tool-panel section .title.green {
  color: #4CD964 !important;
}
.tool.theme-dark .tool-panel section .title.roseo {
  color: #FF2D70 !important;
}
.tool.theme-dark .tool-panel section .title.blue {
  color: #81fffa !important;
}
.tool.theme-dark .tool-panel .tip {
  color: #e6e6e6 !important;
}

body.theme-dark .sync-warning {
  background: #23232b !important;
  color: #ffe082 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  border: 1px solid #333;
}

// 美化 sync-warning（所有页面通用，tool页面dark样式由tool-dark控制）
.sync-warning {
  margin: 0px auto 0px auto;
  padding: 12px 18px;
  border-radius: 8px;
  font-size: 15px;
  line-height: 1.7;
  background: #fffbe6;
  color: #b26a00;
  box-shadow: 0 2px 8px rgba(255, 200, 0, 0.08);
  text-align: left;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-weight: 500;
}

body.theme-dark .sync-warning {
  background: #23232b !important;
  color: #ffe082 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  border: 1px solid #333;
}

// 美化 sync-file-list（config.html专用）
.sync-file-list {
  margin: 0px 0 0px 0;
  padding: 10px 0;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  font-size: 14px;
  overflow: hidden;
}
body.theme-dark .sync-file-list {
  background: #23232b !important;
  color: #e6e6e6 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.sync-file-list .sync-file-item {
  padding: 8px 18px;
  border-bottom: 1px solid #f0f0f0;
  transition: background 0.2s;
}
body.theme-dark .sync-file-list .sync-file-item {
  border-bottom: 1px solid #333;
}
.sync-file-list .sync-file-item:last-child {
  border-bottom: none;
}
.sync-file-list .sync-file-item:hover {
  background: #fffbe6;
}
body.theme-dark .sync-file-list .sync-file-item:hover {
  background: #353535;
}

// 修复index.html中.tool-panel顶部白色问题（只在index页面强制浅色）
body.index .tool-panel {
  background: #fafbfc !important;
  border-top: none !important;
}
body.theme-dark.index .tool-panel {
  background: #23232b !important;
  border-top: none !important;
}

.theme-dark,
html.theme-dark,
body.theme-dark,
html.theme-dark body {
  @include dark-mode();
}

.theme-auto,
html.theme-auto,
body.theme-auto,
html.theme-auto body {
  @media (prefers-color-scheme: dark) {
    @include dark-mode();
    /* 只影响 tool.html 的自动暗黑模式 */
    .tool.theme-auto .tool-panel {
      background-color: #1c1f24 !important;
    }
    .tool.theme-auto .tool-panel .content {
      background-color: #0f0f13 !important;
    }
    .tool.theme-auto .tool-panel section .title {
      color: #e6e6e6 !important;
    }
    .tool.theme-auto .tool-panel section .title.green {
      color: #4CD964 !important;
    }
    .tool.theme-auto .tool-panel section .title.roseo {
      color: #FF2D70 !important;
    }
    .tool.theme-auto .tool-panel section .title.blue {
      color: #81fffa !important;
    }
    .tool.theme-auto .tool-panel .tip {
      color: #e6e6e6 !important;
    }
  }
}

// 3. config.html remove-x美化
.remove-x {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
  font-size: 18px;
  color: #ff2d70;
  cursor: pointer;
  transition: color 0.15s, transform 0.1s, box-shadow 0.1s;
  user-select: none;
  vertical-align: middle;
}
.remove-x:hover {
  color: #fff;
  background: #ff2d70;
  border-radius: 50%;
  box-shadow: 0 2px 8px rgba(255,45,112,0.12);
  transform: scale(1.15);
}
.remove-x:active {
  color: #fff;
  background: #b71c3a;
  transform: scale(0.95);
}

// 3. remove-x title对齐
.sync-file-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

// 4. rename-file-list美化
.rename-file-list {
  margin: 3px 0 3px 0;
  padding: 0px 0;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  font-size: 14px;
  overflow: hidden;
}
body.theme-dark .rename-file-list {
  background: #23232b !important;
  color: #e6e6e6 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.rename-file-list-item {
  display: flex;
  align-items: center;
  gap: 0px;
  padding: 0px 0px;
  border-bottom: 1px solid #f0f0f0;
  transition: background 0.2s;
}
body.theme-dark .rename-file-list-item {
  border-bottom: 1px solid #333;
}
.rename-file-list-item:last-child {
  border-bottom: none;
}
.rename-file-list-item:hover {
  background: #fffbe6;
}
body.theme-dark .rename-file-list-item:hover {
  background: #353535;
}
.rename-file-list-item input {
  flex: 1 1 0;
  min-width: 0;
  max-width: 180px; // 提高最大宽度，便于显示
  border-radius: 4px;
  border: 1px solid #eee;
  padding: 4px 8px;
  font-size: 14px;
  background: #fafbfc;
  color: #333;
  transition: border 0.2s, box-shadow 0.2s;
  margin-left: 4px; // 缩小间距
  box-sizing: border-box;
}
body.theme-dark .rename-file-list-item input {
  background: #23232b;
  color: #e6e6e6;
  border: 1px solid #444;
}
.rename-file-list-item input:focus {
  border: 1.5px solid #ff2d70;
  box-shadow: 0 0 0 2px rgba(255,45,112,0.08);
}
.rename-file-list-item .filepath {
  flex: 0 1 auto;
  min-width: 0;
  max-width: 320px; // 提高最大宽度
  margin-right: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: #888;
}
body.theme-dark .rename-file-list-item .filepath {
  color: #aaa;
}
.rename-file-list-item .remove-x {
  margin-left: 8px;
}

// 2. sync-warning 文字靠左
.sync-warning {
  justify-content: flex-start;
}

// 3. 彻查 main-tool 顶部白色细条
body.index .main-tool,
body.theme-dark.index .main-tool,
.main-tool,
body.theme-dark .main-tool,
body.theme-dark .main-tool:before,
body.theme-dark .main-tool:after,
.theme-dark .main-tool,
html.theme-dark .main-tool,
body.theme-dark .main-tool,
html.theme-dark body .main-tool {
  border-top: none !important;
  // border-left: 1px solid #333 !important;
  background-image: none !important;
  box-shadow: none !important;
  outline: none !important;
  position: relative;
}

// 添加 ::before 伪元素覆盖可能的细线
body.theme-dark .main-tool::before,
.theme-dark .main-tool::before,
html.theme-dark .main-tool::before,
html.theme-dark body .main-tool::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background-color: #1c1f24 !important;
  z-index: 10;
}

// 添加额外的专门针对index页面的::after伪元素，使用更高的z-index确保覆盖顶部的白色细线
body.index.theme-dark .main-tool::after,
body.theme-dark.index .main-tool::after,
.theme-dark.index .main-tool::after,
html.theme-dark.index .main-tool::after {
  content: "";
  position: absolute;
  top: -1px;
  left: 0;
  right: 0;
  height: 1px;
  background-color: #1c1f24;
  z-index: 100;
}

// 添加自定义弹窗样式
.custom-dialog-mask {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.custom-dialog {
  background-color: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  min-width: 300px;
  max-width: 80%;
  margin: 0 20px;
}

.custom-dialog-content {
  text-align: center;
  font-size: 16px;
  line-height: 1.5;
  color: #333;
  margin-bottom: 15px;
}

.custom-dialog-footer {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}

body.theme-dark .custom-dialog {
  background-color: #1c1f24;
  color: #e6e6e6;
  border: 1px solid #333;
}

body.theme-dark .custom-dialog-content {
  color: #e6e6e6;
}

